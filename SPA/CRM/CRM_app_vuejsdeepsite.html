
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM PWA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="manifest" href="/manifest.json">
    <style>
        /* Custom CSS for accessibility and overrides */
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        
        .router-view {
            min-height: calc(100vh - 56px);
        }
        
        .kanban-column {
            min-height: 300px;
            background-color: #f3f4f6;
        }
        
        /* Accessibility focus styles */
        a:focus, button:focus, input:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #ffffff;
            }
            
            .kanban-column {
                background-color: #2d3748;
            }
            
            .card {
                background-color: #2d3748;
                border-color: #4a5568;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- App Container (simulating Vue root) -->
    <div id="app">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-indigo-600 shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="#" @click="currentView = 'dashboard'">CRM PWA</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" :class="{ 'active': currentView === 'dashboard' }" href="#" @click="currentView = 'dashboard'">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{ 'active': currentView === 'contacts' }" href="#" @click="currentView = 'contacts'">Contacts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{ 'active': currentView === 'opportunities' }" href="#" @click="currentView = 'opportunities'">Opportunités</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{ 'active': currentView === 'tasks' }" href="#" @click="currentView = 'tasks'">Tâches</a>
                        </li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <div class="dropdown">
                            <button class="btn btn-outline-light dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown">
                                {{ currentLanguage === 'fr' ? 'Français' : 'English' }}
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" @click="changeLanguage('fr')">Français</a></li>
                                <li><a class="dropdown-item" href="#" @click="changeLanguage('en')">English</a></li>
                            </ul>
                        </div>
                        <div class="dropdown ms-3">
                            <button class="btn btn-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle me-1"></i> {{ currentUser.name }}
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" @click="currentView = 'profile'">Profil</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" @click="logout">Déconnexion</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="router-view container-fluid py-4">
            <!-- Login View -->
            <div v-if="!isAuthenticated" class="row justify-content-center">
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm">
                        <div class="card-body p-4">
                            <h2 class="card-title text-center mb-4">{{ translate('login.title') }}</h2>
                            <form @submit.prevent="login">
                                <div class="mb-3">
                                    <label for="email" class="form-label">{{ translate('login.email') }}</label>
                                    <input type="email" class="form-control" id="email" v-model="loginForm.email" required>
                                </div>
                                <div class="mb-3">
                                    <label for="password" class="form-label">{{ translate('login.password') }}</label>
                                    <input type="password" class="form-control" id="password" v-model="loginForm.password" required>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary">{{ translate('login.submit') }}</button>
                                </div>
                            </form>
                            <div v-if="loginError" class="alert alert-danger mt-3">
                                {{ loginError }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Authenticated Views -->
            <div v-if="isAuthenticated">
                <!-- Dashboard View -->
                <div v-if="currentView === 'dashboard'" class="dashboard-view">
                    <h2 class="mb-4">{{ translate('dashboard.title') }}</h2>
                    
                    <!-- KPI Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">{{ translate('dashboard.contacts') }}</h5>
                                    <p class="display-5">{{ dashboardStats.contacts }}</p>
                                    <p class="text-muted">{{ translate('dashboard.total_contacts') }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">{{ translate('dashboard.opportunities') }}</h5>
                                    <p class="display-5">{{ dashboardStats.opportunities }}</p>
                                    <p class="text-muted">{{ translate('dashboard.open_opportunities') }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">{{ translate('dashboard.tasks') }}</h5>
                                    <p class="display-5">{{ dashboardStats.tasks }}</p>
                                    <p class="text-muted">{{ translate('dashboard.pending_tasks') }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activities -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">{{ translate('dashboard.recent_activities') }}</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li v-for="activity in recentActivities" :key="activity.id" class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <span>{{ activity.description }}</span>
                                        <small class="text-muted">{{ formatDate(activity.date) }}</small>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Contacts View -->
                <div v-if="currentView === 'contacts'" class="contacts-view">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>{{ translate('contacts.title') }}</h2>
                        <button class="btn btn-primary" @click="showContactForm(null)">
                            <i class="bi bi-plus-lg me-1"></i> {{ translate('contacts.add_contact') }}
                        </button>
                    </div>
                    
                    <!-- Search and Filters -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="search" class="form-label">{{ translate('contacts.search') }}</label>
                                    <input type="text" class="form-control" id="search" v-model="contactSearch" @input="filterContacts">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="statusFilter" class="form-label">{{ translate('contacts.filter_by_status') }}</label>
                                    <select class="form-select" id="statusFilter" v-model="contactStatusFilter" @change="filterContacts">
                                        <option value="all">{{ translate('contacts.all') }}</option>
                                        <option value="active">{{ translate('contacts.active') }}</option>
                                        <option value="inactive">{{ translate('contacts.inactive') }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contacts Table -->
                    <div class="card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>{{ translate('contacts.name') }}</th>
                                            <th>{{ translate('contacts.email') }}</th>
                                            <th>{{ translate('contacts.phone') }}</th>
                                            <th>{{ translate('contacts.company') }}</th>
                                            <th>{{ translate('contacts.status') }}</th>
                                            <th>{{ translate('contacts.actions') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="contact in filteredContacts" :key="contact.id">
                                            <td>{{ contact.name }}</td>
                                            <td>{{ contact.email }}</td>
                                            <td>{{ contact.phone }}</td>
                                            <td>{{ contact.company }}</td>
                                            <td>
                                                <span class="badge" :class="contact.status === 'active' ? 'bg-success' : 'bg-secondary'">
                                                    {{ contact.status === 'active' ? translate('contacts.active') : translate('contacts.inactive') }}
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary me-1" @click="showContactForm(contact)">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger" @click="confirmDeleteContact(contact)">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Form Modal -->
                    <div class="modal fade" id="contactModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        {{ currentContact.id ? translate('contacts.edit_contact') : translate('contacts.add_contact') }}
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form @submit.prevent="saveContact">
                                        <div class="mb-3">
                                            <label for="contactName" class="form-label">{{ translate('contacts.name') }}</label>
                                            <input type="text" class="form-control" id="contactName" v-model="currentContact.name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactEmail" class="form-label">{{ translate('contacts.email') }}</label>
                                            <input type="email" class="form-control" id="contactEmail" v-model="currentContact.email">
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactPhone" class="form-label">{{ translate('contacts.phone') }}</label>
                                            <input type="tel" class="form-control" id="contactPhone" v-model="currentContact.phone">
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactCompany" class="form-label">{{ translate('contacts.company') }}</label>
                                            <input type="text" class="form-control" id="contactCompany" v-model="currentContact.company">
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactStatus" class="form-label">{{ translate('contacts.status') }}</label>
                                            <select class="form-select" id="contactStatus" v-model="currentContact.status" required>
                                                <option value="active">{{ translate('contacts.active') }}</option>
                                                <option value="inactive">{{ translate('contacts.inactive') }}</option>
                                            </select>
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">
                                                {{ translate('common.cancel') }}
                                            </button>
                                            <button type="submit" class="btn btn-primary">
                                                {{ translate('common.save') }}
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade" id="deleteContactModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">{{ translate('contacts.confirm_delete') }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p>{{ translate('contacts.delete_warning') }} <strong>{{ contactToDelete.name }}</strong>?</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                        {{ translate('common.cancel') }}
                                    </button>
                                    <button type="button" class="btn btn-danger" @click="deleteContact">
                                        {{ translate('common.delete') }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Opportunities View -->
                <div v-if="currentView === 'opportunities'" class="opportunities-view">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>{{ translate('opportunities.title') }}</h2>
                        <button class="btn btn-primary" @click="showOpportunityForm(null)">
                            <i class="bi bi-plus-lg me-1"></i> {{ translate('opportunities.add_opportunity') }}
                        </button>
                    </div>
                    
                    <!-- Kanban Board -->
                    <div class="kanban-board">
                        <div class="row">
                            <div class="col-md-3 mb-3" v-for="stage in opportunityStages" :key="stage.id">
                                <div class="kanban-column rounded p-3">
                                    <h5 class="text-center mb-3">{{ stage.name }}</h5>
                                    <div class="kanban-cards">
                                        <div class="card mb-3" v-for="opportunity in opportunities.filter(o => o.stage === stage.id)" :key="opportunity.id">
                                            <div class="card-body">
                                                <h6 class="card-title">{{ opportunity.name }}</h6>
                                                <p class="card-text text-muted small">{{ opportunity.company }}</p>
                                                <p class="card-text">{{ opportunity.amount }} €</p>
                                                <div class="d-flex justify-content-between">
                                                    <span class="badge bg-primary">{{ opportunity.probability }}%</span>
                                                    <div>
                                                        <button class="btn btn-sm btn-outline-primary me-1" @click="showOpportunityForm(opportunity)">
                                                            <i class="bi bi-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-danger" @click="confirmDeleteOpportunity(opportunity)">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks View -->
                <div v-if="currentView === 'tasks'" class="tasks-view">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>{{ translate('tasks.title') }}</h2>
                        <button class="btn btn-primary" @click="showTaskForm(null)">
                            <i class="bi bi-plus-lg me-1"></i> {{ translate('tasks.add_task') }}
                        </button>
                    </div>
                    
                    <!-- Calendar View -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div id="taskCalendar"></div>
                        </div>
                    </div>
                    
                    <!-- Task List -->
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#">{{ translate('tasks.all_tasks') }}</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">{{ translate('tasks.my_tasks') }}</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">{{ translate('tasks.completed') }}</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>{{ translate('tasks.title') }}</th>
                                            <th>{{ translate('tasks.due_date') }}</th>
                                            <th>{{ translate('tasks.priority') }}</th>
                                            <th>{{ translate('tasks.status') }}</th>
                                            <th>{{ translate('tasks.assigned_to') }}</th>
                                            <th>{{ translate('tasks.actions') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="task in tasks" :key="task.id">
                                            <td>{{ task.title }}</td>
                                            <td>{{ formatDate(task.due_date) }}</td>
                                            <td>
                                                <span class="badge" :class="getPriorityBadgeClass(task.priority)">
                                                    {{ translate(`tasks.priority_${task.priority}`) }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge" :class="task.completed ? 'bg-success' : 'bg-warning'">
                                                    {{ task.completed ? translate('tasks.completed') : translate('tasks.pending') }}
                                                </span>
                                            </td>
                                            <td>{{ task.assigned_to }}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary me-1" @click="showTaskForm(task)">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger" @click="confirmDeleteTask(task)">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile View -->
                <div v-if="currentView === 'profile'" class="profile-view">
                    <h2 class="mb-4">{{ translate('profile.title') }}</h2>
                    
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="avatar mb-3">
                                        <img src="https://ui-avatars.com/api/?name={{ currentUser.name }}&background=4f46e5&color=fff&size=150" 
                                             class="rounded-circle" width="150" height="150" alt="Profile">
                                    </div>
                                    <h4>{{ currentUser.name }}</h4>
                                    <p class="text-muted">{{ currentUser.email }}</p>
                                    <button class="btn btn-outline-primary">
                                        {{ translate('profile.change_photo') }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">{{ translate('profile.personal_info') }}</h5>
                                    <form @submit.prevent="updateProfile">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="firstName" class="form-label">{{ translate('profile.first_name') }}</label>
                                                <input type="text" class="form-control" id="firstName" v-model="profileForm.first_name">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="lastName" class="form-label">{{ translate('profile.last_name') }}</label>
                                                <input type="text" class="form-control" id="lastName" v-model="profileForm.last_name">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="email" class="form-label">{{ translate('profile.email') }}</label>
                                            <input type="email" class="form-control" id="email" v-model="profileForm.email" disabled>
                                        </div>
                                        <div class="mb-3">
                                            <label for="phone" class="form-label">{{ translate('profile.phone') }}</label>
                                            <input type="tel" class="form-control" id="phone" v-model="profileForm.phone">
                                        </div>
                                        <div class="mb-3">
                                            <label for="language" class="form-label">{{ translate('profile.language') }}</label>
                                            <select class="form-select" id="language" v-model="profileForm.language">
                                                <option value="fr">Français</option>
                                                <option value="en">English</option>
                                            </select>
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button type="submit" class="btn btn-primary">
                                                {{ translate('profile.save_changes') }}
                                            </button>
                                        </div>
                                    </form>
                                    
                                    <hr class="my-4">
                                    
                                    <h5 class="card-title mb-4">{{ translate('profile.change_password') }}</h5>
                                    <form @submit.prevent="changePassword">
                                        <div class="mb-3">
                                            <label for="currentPassword" class="form-label">{{ translate('profile.current_password') }}</label>
                                            <input type="password" class="form-control" id="currentPassword" v-model="passwordForm.current_password">
                                        </div>
                                        <div class="mb-3">
                                            <label for="newPassword" class="form-label">{{ translate('profile.new_password') }}</label>
                                            <input type="password" class="form-control" id="newPassword" v-model="passwordForm.new_password">
                                        </div>
                                        <div class="mb-3">
                                            <label for="confirmPassword" class="form-label">{{ translate('profile.confirm_password') }}</label>
                                            <input type="password" class="form-control" id="confirmPassword" v-model="passwordForm.confirm_password">
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button type="submit" class="btn btn-primary">
                                                {{ translate('profile.update_password') }}
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-light py-3 mt-auto">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-0">© 2023 CRM PWA. {{ translate('footer.all_rights_reserved') }}</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            <span v-if="isOnline" class="text-success">
                                <i class="bi bi-wifi"></i> {{ translate('footer.online') }}
                            </span>
                            <span v-else class="text-warning">
                                <i class="bi bi-wifi-off"></i> {{ translate('footer.offline') }}
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <!-- Script for our app -->
    <script>
        // Simulating Vue Composition API
        const app = {
            data() {
                return {
                    // App state
                    isAuthenticated: false,
                    currentView: 'dashboard',
                    currentLanguage: 'fr',
                    isOnline: true,
                    
                    // Current user
                    currentUser: {
                        id: 1,
                        name: 'Admin User',
                        email: 'admin@example.com',
                        role: 'admin'
                    },
                    
                    // Login form
                    loginForm: {
                        email: '',
                        password: ''
                    },
                    loginError: '',
                    
                    // Profile form
                    profileForm: {
                        first_name: 'Admin',
                        last_name: 'User',
                        email: 'admin@example.com',
                        phone: '+33 6 12 34 56 78',
                        language: 'fr'
                    },
                    
                    // Password form
                    passwordForm: {
                        current_password: '',
                        new_password: '',
                        confirm_password: ''
                    },
                    
                    // Dashboard data
                    dashboardStats: {
                        contacts: 124,
                        opportunities: 18,
                        tasks: 7
                    },
                    recentActivities: [
                        { id: 1, description: 'Nouveau contact ajouté: Jean Dupont', date: '2023-06-15T10:30:00' },
                        { id: 2, description: 'Opportunité mise à jour: Projet X', date: '2023-06-14T15:45:00' },
                        { id: 3, description: 'Tâche complétée: Appeler le client Y', date: '2023-06-14T09:15:00' },
                        { id: 4, description: 'Email envoyé à: contact@company.com', date: '2023-06-13T16:20:00' }
                    ],
                    
                    // Contacts data
                    contacts: [
                        { id: 1, name: 'Jean Dupont', email: 'jean.dupont@example.com', phone: '+33 6 12 34 56 78', company: 'Acme Corp', status: 'active' },
                        { id: 2, name: 'Marie Martin', email: 'marie.martin@example.com', phone: '+33 6 23 45 67 89', company: 'Tech Solutions', status: 'active' },
                        { id: 3, name: 'Pierre Durand', email: 'pierre.durand@example.com', phone: '+33 6 34 56 78 90', company: 'Global Inc', status: 'inactive' },
                        { id: 4, name: 'Sophie Lambert', email: 'sophie.lambert@example.com', phone: '+33 6 45 67 89 01', company: 'Digital Partners', status: 'active' },
                        { id: 5, name: 'Thomas Moreau', email: 'thomas.moreau@example.com', phone: '+33 6 56 78 90 12', company: 'Innovate Ltd', status: 'inactive' }
                    ],
                    contactSearch: '',
                    contactStatusFilter: 'all',
                    filteredContacts: [],
                    currentContact: {
                        id: null,
                        name: '',
                        email: '',
                        phone: '',
                        company: '',
                        status: 'active'
                    },
                    contactToDelete: null,
                    
                    // Opportunities data
                    opportunityStages: [
                        { id: 'new', name: 'Nouveau' },
                        { id: 'qualification', name: 'Qualification' },
                        { id: 'proposal', name: 'Proposition' },
                        { id: 'negotiation', name: 'Négociation' },
                        { id: 'closed_won', name: 'Gagné' },
                        { id: 'closed_lost', name: 'Perdu' }
                    ],
                    opportunities: [
                        { id: 1, name: 'Projet X', company: 'Acme Corp', amount: 15000, probability: 20, stage: 'new' },
                        { id: 2, name: 'Site web', company: 'Tech Solutions', amount: 8000, probability: 50, stage: 'qualification' },
                        { id: 3, name: 'Application mobile', company: 'Global Inc', amount: 25000, probability: 70, stage: 'proposal' },
                        { id: 4, name: 'Consulting', company: 'Digital Partners', amount: 12000, probability: 30, stage: 'qualification' },
                        { id: 5, name: 'Formation', company: 'Innovate Ltd', amount: 5000, probability: 90, stage: 'negotiation' }
                    ],
                    currentOpportunity: null,
                    opportunityToDelete: null,
                    
                    // Tasks data
                    tasks: [
                        { id: 1, title: 'Appeler Jean Dupont', due_date: '2023-06-16', priority: 'high', completed: false, assigned_to: 'Moi' },
                        { id: 2, title: 'Préparer proposition', due_date: '2023-06-18', priority: 'medium', completed: false, assigned_to: 'Équipe' },
                        { id: 3, title: 'Envoyer contrat', due_date: '2023-06-20', priority: 'low', completed: true, assigned_to: 'Moi' },
                        { id: 4, title: 'Réunion avec client', due_date: '2023-06-22', priority: 'high', completed: false, assigned_to: 'Équipe' }
                    ],
                    currentTask: null,
                    taskToDelete: null,
                    
                    // Translation dictionary
                    translations: {
                        fr: {
                            login: {
                                title: 'Connexion',
                                email: 'Email',
                                password: 'Mot de passe',
                                submit: 'Se connecter'
                            },
                            dashboard: {
                                title: 'Tableau de bord',
                                contacts: 'Contacts',
                                total_contacts: 'Contacts totaux',
                                opportunities: 'Opportunités',
                                open_opportunities: 'Opportunités ouvertes',
                                tasks: 'Tâches',
                                pending_tasks: 'Tâches en attente',
                                recent_activities: 'Activités récentes'
                            },
                            contacts: {
                                title: 'Contacts',
                                add_contact: 'Ajouter un contact',
                                edit_contact: 'Modifier le contact',
                                search: 'Rechercher',
                                filter_by_status: 'Filtrer par statut',
                                all: 'Tous',
                                active: 'Actif',
                                inactive: 'Inactif',
                                name: 'Nom',
                                email: 'Email',
                                phone: 'Téléphone',
                                company: 'Entreprise',
                                status: 'Statut',
                                actions: 'Actions',
                                confirm_delete: 'Confirmer la suppression',
                                delete_warning: 'Êtes-vous sûr de vouloir supprimer le contact'
                            },
                            opportunities: {
                                title: 'Opportunités',
                                add_opportunity: 'Ajouter une opportunité'
                            },
                            tasks: {
                                title: 'Tâches',
                                add_task: 'Ajouter une tâche',
                                all_tasks: 'Toutes les tâches',
                                my_tasks: 'Mes tâches',
                                completed: 'Terminées',
                                due_date: 'Date d\'échéance',
                                priority: 'Priorité',
                                priority_high: 'Haute',
                                priority_medium: 'Moyenne',
                                priority_low: 'Basse',
                                status: 'Statut',
                                assigned_to: 'Assigné à',
                                actions: 'Actions',
                                pending: 'En attente',
                                completed: 'Terminée'
                            },
                            profile: {
                                title: 'Profil',
                                personal_info: 'Informations personnelles',
                                first_name: 'Prénom',
                                last_name: 'Nom',
                                email: 'Email',
                                phone: 'Téléphone',
                                language: 'Langue',
                                save_changes: 'Enregistrer les modifications',
                                change_password: 'Changer le mot de passe',
                                current_password: 'Mot de passe actuel',
                                new_password: 'Nouveau mot de passe',
                                confirm_password: 'Confirmer le mot de passe',
                                update_password: 'Mettre à jour le mot de passe',
                                change_photo: 'Changer la photo'
                            },
                            common: {
                                cancel: 'Annuler',
                                save: 'Enregistrer',
                                delete: 'Supprimer'
                            },
                            footer: {
                                all_rights_reserved: 'Tous droits réservés',
                                online: 'En ligne',
                                offline: 'Hors ligne'
                            }
                        },
                        en: {
                            login: {
                                title: 'Login',
                                email: 'Email',
                                password: 'Password',
                                submit: 'Sign in'
                            },
                            dashboard: {
                                title: 'Dashboard',
                                contacts: 'Contacts',
                                total_contacts: 'Total contacts',
                                opportunities: 'Opportunities',
                                open_opportunities: 'Open opportunities',
                                tasks: 'Tasks',
                                pending_tasks: 'Pending tasks',
                                recent_activities: 'Recent activities'
                            },
                            contacts: {
                                title: 'Contacts',
                                add_contact: 'Add contact',
                                edit_contact: 'Edit contact',
                                search: 'Search',
                                filter_by_status: 'Filter by status',
                                all: 'All',
                                active: 'Active',
                                inactive: 'Inactive',
                                name: 'Name',
                                email: 'Email',
                                phone: 'Phone',
                                company: 'Company',
                                status: 'Status',
                                actions: 'Actions',
                                confirm_delete: 'Confirm deletion',
                                delete_warning: 'Are you sure you want to delete the contact'
                            },
                            opportunities: {
                                title: 'Opportunities',
                                add_opportunity: 'Add opportunity'
                            },
                            tasks: {
                                title: 'Tasks',
                                add_task: 'Add task',
                                all_tasks: 'All tasks',
                                my_tasks: 'My tasks',
                                completed: 'Completed',
                                due_date: 'Due date',
                                priority: 'Priority',
                                priority_high: 'High',
                                priority_medium: 'Medium',
                                priority_low: 'Low',
                                status: 'Status',
                                assigned_to: 'Assigned to',
                                actions: 'Actions',
                                pending: 'Pending',
                                completed: 'Completed'
                            },
                            profile: {
                                title: 'Profile',
                                personal_info: 'Personal information',
                                first_name: 'First name',
                                last_name: 'Last name',
                                email: 'Email',
                                phone: 'Phone',
                                language: 'Language',
                                save_changes: 'Save changes',
                                change_password: 'Change password',
                                current_password: 'Current password',
                                new_password: 'New password',
                                confirm_password: 'Confirm password',
                                update_password: 'Update password',
                                change_photo: 'Change photo'
                            },
                            common: {
                                cancel: 'Cancel',
                                save: 'Save',
                                delete: 'Delete'
                            },
                            footer: {
                                all_rights_reserved: 'All rights reserved',
                                online: 'Online',
                                offline: 'Offline'
                            }
                        }
                    }
                };
            },
            
            created() {
                // Initialize filtered contacts
                this.filterContacts();
                
                // Check online status
                this.checkOnlineStatus();
                
                // Set up event listeners for online/offline
                window.addEventListener('online', this.checkOnlineStatus);
                window.addEventListener('offline', this.checkOnlineStatus);
                
                // Check if user is authenticated (simulating token in localStorage)
                const token = localStorage.getItem('authToken');
                if (token) {
                    this.isAuthenticated = true;
                    this.currentView = 'dashboard';
                }
                
                // Initialize modals
                this.initModals();
            },
            
            methods: {
                // Translation helper
                translate(key) {
                    const keys = key.split('.');
                    let result = this.translations[this.currentLanguage];
                    
                    for (const k of keys) {
                        if (result && result[k]) {
                            result = result[k];
                        } else {
                            return key; // return the key if translation not found
                        }
                    }
                    
                    return result;
                },
                
                // Change language
                changeLanguage(lang) {
                    this.currentLanguage = lang;
                    localStorage.setItem('preferredLanguage', lang);
                },
                
                // Login method
                login() {
                    // Simulate API call with Axios
                    axios.post('/api/auth/login', this.loginForm)
                        .then(response => {
                            // In a real app, we would store the token
                            localStorage.setItem('authToken', 'simulated-token');
                            this.isAuthenticated = true;
                            this.currentView = 'dashboard';
                            this.loginError = '';
                        })
                        .catch(error => {
                            // Simulate error
                            this.loginError = this.translate('login.invalid_credentials');
                        });
                },
                
                // Logout method
                logout() {
                    // Simulate API call with Axios
                    axios.post('/api/auth/logout')
                        .then(() => {
                            localStorage.removeItem('authToken');
                            this.isAuthenticated = false;
                            this.currentView = 'login';
                        })
                        .catch(error => {
                            console.error('Logout error:', error);
                        });
                },
                
                // Filter contacts based on search and status
                filterContacts() {
                    this.filteredContacts = this.contacts.filter(contact => {
                        const matchesSearch = contact.name.toLowerCase().includes(this.contactSearch.toLowerCase()) ||
                                             contact.email.toLowerCase().includes(this.contactSearch.toLowerCase()) ||
                                             contact.company.toLowerCase().includes(this.contactSearch.toLowerCase());
                        
                        const matchesStatus = this.contactStatusFilter === 'all' || 
                                             contact.status === this.contactStatusFilter;
                        
                        return matchesSearch && matchesStatus;
                    });
                },
                
                // Show contact form
                showContactForm(contact) {
                    if (contact) {
                        this.currentContact = { ...contact };
                    } else {
                        this.currentContact = {
                            id: null,
                            name: '',
                            email: '',
                            phone: '',
                            company: '',
                            status: 'active'
                        };
                    }
                    
                    const modal = new bootstrap.Modal(document.getElementById('contactModal'));
                    modal.show();
                },
                
                // Save contact
                saveContact() {
                    if (this.currentContact.id) {
                        // Update existing contact
                        const index = this.contacts.findIndex(c => c.id === this.currentContact.id);
                        if (index !== -1) {
                            this.contacts[index] = { ...this.currentContact };
                        }
                    } else {
                        // Add new contact
                        const newId = Math.max(...this.contacts.map(c => c.id)) + 1;
                        this.currentContact.id = newId;
                        this.contacts.push({ ...this.currentContact });
                    }
                    
                    this.filterContacts();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
                    modal.hide();
                },
                
                // Confirm delete contact
                confirmDeleteContact(contact) {
                    this.contactToDelete = contact;
                    const modal = new bootstrap.Modal(document.getElementById('deleteContactModal'));
                    modal.show();
                },
                
                // Delete contact
                deleteContact() {
                    this.contacts = this.contacts.filter(c => c.id !== this.contactToDelete.id);
                    this.filterContacts();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteContactModal'));
                    modal.hide();
                    this.contactToDelete = null;
                },
                
                // Show opportunity form
                showOpportunityForm(opportunity) {
                    // Similar to contact form
                    console.log('Show opportunity form:', opportunity);
                },
                
                // Confirm delete opportunity
                confirmDeleteOpportunity(opportunity) {
                    // Similar to contact delete
                    console.log('Confirm delete opportunity:', opportunity);
                },
                
                // Show task form
                showTaskForm(task) {
                    // Similar to contact form
                    console.log('Show task form:', task);
                },
                
                // Confirm delete task
                confirmDeleteTask(task) {
                    // Similar to contact delete
                    console.log('Confirm delete task:', task);
                },
                
                // Update profile
                updateProfile() {
                    // Simulate API call
                    axios.put('/api/profile', this.profileForm)
                        .then(response => {
                            // Update current user
                            this.currentUser.name = `${this.profileForm.first_name} ${this.profileForm.last_name}`;
                            this.currentUser.email = this.profileForm.email;
                            
                            // Change language if needed
                            if (this.profileForm.language !== this.currentLanguage) {
                                this.changeLanguage(this.profileForm.language);
                            }
                            
                            alert(this.translate('profile.changes_saved'));
                        })
                        .catch(error => {
                            console.error('Profile update error:', error);
                        });
                },
                
                // Change password
                changePassword() {
                    // Simulate API call
                    axios.post('/api/auth/change-password', this.passwordForm)
                        .then(response => {
                            // Clear form
                            this.passwordForm = {
                                current_password: '',
                                new_password: '',
                                confirm_password: ''
                            };
                            
                            alert(this.translate('profile.password_updated'));
                        })
                        .catch(error => {
                            console.error('Password change error:', error);
                        });
                },
                
                // Format date
                formatDate(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString(this.currentLanguage);
                },
                
                // Get priority badge class
                getPriorityBadgeClass(priority) {
                    switch (priority) {
                        case 'high': return 'bg-danger';
                        case 'medium': return 'bg-warning';
                        case 'low': return 'bg-info';
                        default: return 'bg-secondary';
                    }
                },
                
                // Check online status
                checkOnlineStatus() {
                    this.isOnline = navigator.onLine;
                },
                
                // Initialize Bootstrap modals
                initModals() {
                    // This would be handled automatically in Vue with proper components
                    // Here we're simulating it for our single-file demo
                    const modalElements = document.querySelectorAll('.modal');
                    modalElements.forEach(modalEl => {
                        modalEl.addEventListener('hidden.bs.modal', () => {
                            // Reset forms when modal is closed
                            if (modalEl.id === 'contactModal') {
                                this.currentContact = {
                                    id: null,
                                    name: '',
                                    email: '',
                                    phone: '',
                                    company: '',
                                    status: 'active'
                                };
                            }
                        });
                    });
                }
            }
        };
        
        // Initialize our app
        document.addEventListener('DOMContentLoaded', () => {
            // Mount the app
            const mountedApp = app.data();
            for (const [key, value] of Object.entries(mountedApp)) {
                app[key] = value;
            }
            
            // Add methods to app
            for (const [key, value] of Object.entries(app.methods)) {
                app[key] = value.bind(app);
            }
            
            // Check for preferred language
            const preferredLanguage = localStorage.getItem('preferredLanguage');
            if (preferredLanguage) {
                app.currentLanguage = preferredLanguage;
                app.profileForm.language = preferredLanguage;
            }
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js').then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }).catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
                });
            }
        });
        
        // Simple manifest.json simulation
        const manifest = {
            "name": "CRM PWA",
            "short_name": "CRM",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#4f46e5",
            "icons": [
                {
                    "src": "/icons/icon-192x192.png",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "/icons/icon-512x512.png",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };
        
        // Simple service worker simulation
        const serviceWorkerScript = `
            const CACHE_NAME = 'crm-pwa-cache-v1';
            const urlsToCache = [
                '/',
                '/index.html',
                '/styles/main.css',
                '/scripts/main.js',
                '/images/logo.png'
            ];
            
            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => {
                            return cache.addAll(urlsToCache);
                        })
                );
            });
            
            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });
        `;
    </script>
</body>
</html>