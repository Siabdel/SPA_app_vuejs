<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MM Conciergerie HappyBee</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">



  <!-- Police -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- CSS externe -->
  <link href="style_beehappy.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img src="https://static.photos/yellow/40x40/1" alt="HappyBee Logo" class="bee-icon rounded-circle">
          MM Conciergerie HappyBee
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav" v-if="isAuthenticated">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" :class="{active: activeSection === 'dashboard'}" @click="navigateTo('dashboard')">Tableau de bord</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" :class="{active: activeSection === 'calendar'}" @click="navigateTo('calendar')">Calendrier</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" :class="{active: activeSection === 'add-booking'}" @click="navigateTo('add-booking')">Nouvelle réservation</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" @click="logout">Déconnexion</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main -->
    <main class="container">
      <!-- Connexion -->
      <section class="section d-flex align-items-center" v-if="!isAuthenticated">
        <div class="container col-3 center">
          <div class="login-container">
            <h2 class="text-center mb-4" style="color: var(--primary-blue)">Connexion</h2>
            <form @submit.prevent="login">
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" class="form-control" v-model="loginForm.email" required>
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Mot de passe</label>
                <input type="password" id="password" class="form-control" v-model="loginForm.password" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Se connecter</button>
              <div v-if="loginError" class="alert alert-danger mt-3">{{ loginError }}</div>
            </form>
          </div>
        </div>
      </section>

      <!-- Dashboard -->
      <section class="section" v-if="isAuthenticated && activeSection === 'dashboard'">
        <div class="container">
          <h2 class="mb-4" style="color: var(--primary-blue)">Tableau de bord</h2>
          <div class="card">
            <div class="card-header">Réservations de la semaine</div>
            <div class="card-body">
              <table class="table table-hover" v-if="weeklyBookings.length">
                <thead>
                  <tr><th>Date</th><th>Heure</th><th>Service</th><th>Client</th><th>Statut</th><th>Actions</th></tr>
                </thead>
                <tbody>
                  <tr v-for="b in weeklyBookings" :key="b.id">
                    <td>{{ b.date }}</td>
                    <td>{{ b.time }}</td>
                    <td>{{ b.service }}</td>
                    <td>{{ b.client }}</td>
                    <td>
                      <span class="badge"
                        :class="{'bg-warning': b.status==='pending','bg-success': b.status==='confirmed','bg-danger': b.status==='cancelled'}">
                        {{ b.status }}
                      </span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-primary me-1">Modifier</button>
                      <button class="btn btn-sm btn-danger">Annuler</button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <p v-else>Aucune réservation cette semaine</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Calendrier -->
      <section class="section" v-if="isAuthenticated && activeSection === 'calendar'">
        <div class="container">
          <h2 class="mb-4" style="color: var(--primary-blue)">Calendrier</h2>
          <div class="card"><div class="card-body"><div id="calendar"></div></div></div>
        </div>
      </section>

      <!-- Ajouter réservation -->
      <section class="section" v-if="isAuthenticated && activeSection === 'add-booking'">
        <div class="container">
          <h2 class="mb-4" style="color: var(--primary-blue)">Nouvelle réservation</h2>
          <form @submit.prevent="submitBooking" class="card p-3">
            <div class="row mb-3">
              <div class="col-md-6"><label>Client</label><input type="text" class="form-control" v-model="bookingForm.client" required></div>
              <div class="col-md-6"><label>Service</label>
                <select class="form-select" v-model="bookingForm.service" required>
                  <option value="">Sélectionner</option>
                  <option>Nettoyage</option><option>Garde d'enfants</option><option>Courses</option><option>Réparation</option>
                </select>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6"><label>Date</label><input type="date" class="form-control" v-model="bookingForm.date" required></div>
              <div class="col-md-6"><label>Heure</label><input type="time" class="form-control" v-model="bookingForm.time" required></div>
            </div>
            <textarea v-model="bookingForm.notes" class="form-control mb-3" placeholder="Remarques"></textarea>
            <button class="btn btn-primary w-100">Enregistrer</button>
          </form>
          <div v-if="bookingSuccess" class="alert alert-success mt-3">Réservation ajoutée !</div>
          <div v-if="bookingError" class="alert alert-danger mt-3">{{ bookingError }}</div>
        </div>
      </section>
    </main>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- FullCalendar -->
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/vue3@5.11.2/index.global.min.js"></script>

  <!-- FullCalendar JS (global, pas besoin de core/daygrid/timegrid séparés) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>



  <script>
    const { createApp, ref, onMounted } = Vue

    createApp({
      setup() {
        const isAuthenticated = ref(false)
        const activeSection = ref('dashboard')
        const loginForm = ref({email:'', password:''})
        const bookingForm = ref({client:'',service:'',date:'',time:'',notes:''})
        const loginError = ref('')
        const bookingSuccess = ref(false)
        const bookingError = ref('')

        const weeklyBookings = ref([
          { id:1, date:'2025-09-10', time:'10:00', service:'Nettoyage', client:'Marie Dupont', status:'confirmed'},
          { id:2, date:'2025-09-11', time:'15:00', service:'Courses', client:'Jean Martin', status:'pending'}
        ])

        // Auth
        const login = () => {
          if (loginForm.value.email==='admin@happybee.com' && loginForm.value.password==='password') {
            isAuthenticated.value = true
            loginError.value = ''
            initCalendar()
          } else {
            loginError.value = 'Email ou mot de passe incorrect'
          }
        }
        const logout = () => { isAuthenticated.value = false; activeSection.value='dashboard' }
        const navigateTo = (s) => { activeSection.value = s; if (s==='calendar') initCalendar() }

        // Booking
        const submitBooking = () => {
          if (!bookingForm.value.client || !bookingForm.value.service || !bookingForm.value.date || !bookingForm.value.time) {
            bookingError.value = 'Champs obligatoires manquants'; return
          }
          const newB = {...bookingForm.value, id:Date.now(), status:'pending'}
          weeklyBookings.value.push(newB)
          calendar.addEvent({ title:`${newB.service} - ${newB.client}`, start:`${newB.date}T${newB.time}` })
          bookingForm.value={client:'',service:'',date:'',time:'',notes:''}
          bookingSuccess.value = true; bookingError.value = ''
          setTimeout(()=>bookingSuccess.value=false,2000)
        }

        // Calendar
        let calendar;

        const initCalendar = () => {
          const el = document.getElementById('calendar');
          if (el && !el.dataset.fcRendered) {
            calendar = new FullCalendar.Calendar(el, {
              initialView: 'dayGridMonth',
              locale: 'fr',
              headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
              },
              events: [
                { title: 'Nettoyage - Dupont', start: '2025-09-10T10:00:00' },
                { title: 'Courses - Jean', start: '2025-09-11T14:00:00' }
              ]
            });
            calendar.render();
            el.dataset.fcRendered = "true";
          }
        };


        onMounted(()=>{})

        return {isAuthenticated,activeSection,loginForm,bookingForm,loginError,bookingError,bookingSuccess,weeklyBookings,login,logout,navigateTo,submitBooking}
      }
    }).mount('#app')
  </script>
</body>
</html>
